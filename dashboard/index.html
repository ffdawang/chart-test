<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>仓位历史管控台 - 仓位</title>
<link href="css/style.css" rel="stylesheet" type="text/css">
<script src="js/jquery-1.11.1.min.js"></script>
<script src="js/dygraph-combined.js"></script>
<script src="js/synchronizer.js"></script>
<script src="js/data.js"></script>

<script>
// This function draws bars for a single series. See
      // multiColumnBarPlotter below for a plotter which can draw multi-series
      // bar charts.
    function barChartPlotter(e) {
        var ctx = e.drawingContext;
        var points = e.points;
        var y_bottom = e.dygraph.toDomYCoord(0);

        ctx.fillStyle = darkenColor(e.color);

        // Find the minimum separation between x-values.
        // This determines the bar width.
        var min_sep = Infinity;
        for (var i = 1; i < points.length; i++) {
            var sep = points[i].canvasx - points[i - 1].canvasx;
            if (sep < min_sep) min_sep = sep;
        }
        var bar_width = Math.floor(2.0 / 3 * min_sep);

        // Do the actual plotting.
        for (var i = 0; i < points.length; i++) {
            var p = points[i];
            var center_x = p.canvasx;

            ctx.fillRect(center_x - bar_width / 2, p.canvasy,
                bar_width, y_bottom - p.canvasy);

            ctx.strokeRect(center_x - bar_width / 2, p.canvasy,
                bar_width, y_bottom - p.canvasy);
        }
    }

    var g_graph = null;
    var createGraph = function(data) {
        var highlight_start = 5;
        var highlight_end = 10;
        if( g_graph ) g_graph.destroy();
        g_graph = new Dygraph(
            document.getElementById("cangwei"),
            data,
            {
                labels:['时间', 'Y1', 'Y2', 'Y3'],
                series:{
                    'Y1':{
                        axis:'y1'
                    },
                    'Y2':{
                        axis:'y2'
                    }
                },
                axes:{
                    y2:{
                        labelsKMB:true
                    }
                },
                ylabel:'重量',
                y2label:'体积', 
                strokeWidth: 2,
                drawGrid: false,
                visibility:[true,true,false],
                //axisLineColor: "rgba(255,255,255,0.7)",
                underlayCallback: function(canvas, area, g) {
                    function highlight_event(x_start, eventType) {
                        if( eventType == 101 ) canvas.fillStyle='rgba(255,100,100,1.0)';
                        else if( eventType == 102 ) canvas.fillStyle='rgba(255,255,50,1.0)';
                        else return;
                        var canvas_left_x = g.toDomXCoord(x_start);
                        canvas.strokeStyle='#FF0000';
                        canvas.lineWidth = 2;
                        canvas.beginPath();
                        canvas.moveTo(canvas_left_x, area.y);
                        canvas.lineTo(canvas_left_x, area.h);
                        canvas.closePath();
                        canvas.stroke();
                    }
                        canvas.strokeStyle='#FF0000';
                        canvas.lineWidth = 2;
                        canvas.moveTo(0,0);
                        canvas.lineTo(100,100);
                    for( i=0; i<g.numRows(); i++ ) {
                        w = g.getValue(i,3);
                        if( w != 10 ) {
                            a = g.getValue(i,0);
                            highlight_event( a, w);
                        }
                    }
                    //var bottom_left = g.toDomCoords(highlight_start, -2);
                    //var top_right = g.toDomCoords(highlight_end, +2);
                    //var left = bottom_left[1];
                    //var right = top_right[1];
                    //canvas.fillStyle = "rgba(255, 255, 102, 1.0)";
                    //canvas.fillRect(left, area.y, right - left, area.h);
                }                    
            }
        );
    }

    $(document).ready(function () {
            // load data 
            var dataList = DataList.create();
            var data = '';
            $.get('../data/index20160726.txt', function(txt){
                dataList.load(txt);
                data = '';
                data = dataList.prepareData('3hour');
                createGraph(data);
            })
        }
);
</script>
</head>

<body>
<div class="banner">
	<div class="logo">
    	<img src="images/logo.png">
    </div>
    <div class="menu menu-active">
    仓位
    </div>
    <div class="menu">
    <a href="overall.html">全景</a>
    </div>
    <div class="menu">
    <span style="text-decoration: underline">仓库</span>：佛山铁峰仓
    </div>
    <div class="clear">
    </div>
</div>

<div class="main">
	<div class="numbers">
    	<button class="number">
        1
        </button>
        <button class="number">
        2
        </button>
        <button class="number">
        3
        </button>
        <button class="number">
        4
        </button>
        <button class="number">
        5
        </button>
        <button class="number">
        6
        </button>
        <button class="number">
        7
        </button>
        <button class="number">
        8
        </button>
        <button class="number number-active">
        9
        </button>
        <button class="number">
        10
        </button>
        <button class="number">
        11
        </button>
        <button class="number">
        12
        </button>
        <button class="number">
        13
        </button>
        <button class="number">
        14
        </button>
        <button class="number">
        15
        </button>
    </div>
    <div class="content">
    	<div class="chart-container">
        	<div class="charts">
            	<div id="cangwei" style="width: 100%; height: 45vh;"></div>
            </div>
            <div class="controller">
            	<div class="time-choose">
                <button class="time-pick">10天</button> <button class="time-pick time-selected">1天</button> <button class="time-pick">3小时</button>
                </div>
                <div class="wh-info">
                重量：455.747T&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;体积：68.204M3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;最新更新时间：00:01
                </div>
                <div class="clear">
                </div>
            </div>
        </div>
        <div class="image-container">
        	<div class="images">
            	<img src="images/img-1.jpg">
                <img src="images/img-1.jpg">
                <img src="images/img-1.jpg">
                <img src="images/img-1.jpg">
            </div>
            <div class="scan-image">
            	<img src="images/scan-img.jpg">
            </div>
            <div class="clear">
            </div>
        </div>
        
    </div>
    <div class="clear">
    </div>
</div>

</body>
</html>
